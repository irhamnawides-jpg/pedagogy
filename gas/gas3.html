 <!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistem Tebaran Nilai</title>

<style>
body{
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#667eea,#764ba2);
  min-height:100vh;
  margin:0;
  padding:20px;
}
.container{
  max-width:800px;
  margin:auto;
  background:#fff;
  padding:25px;
  border-radius:15px;
  box-shadow:0 10px 30px rgba(0,0,0,.2);
}
h3{border-bottom:2px solid #eee;padding-bottom:10px}
.login-section,.input-section{
  background:#f8f9fa;
  padding:20px;
  border-radius:10px;
  margin-bottom:20px;
}
.input-row{
  display:flex;
  gap:10px;
  align-items:center;
  margin-bottom:10px;
}
input,textarea{
  width:100%;
  padding:10px;
  border:2px solid #ddd;
  border-radius:5px;
  font-size:15px;
}
textarea{resize:vertical}
.btn{
  padding:10px 18px;
  border:none;
  border-radius:5px;
  font-weight:bold;
  cursor:pointer;
  color:#fff;
}
.btn-cari{background:#9C27B0}
.btn-save{background:#4CAF50}
.btn-modal{background:#FF9800}
.hidden{display:none}

#h{
  margin-top:15px;
  padding:12px;
  border-radius:5px;
  font-weight:bold;
}
.success{background:#d4edda;color:#155724}
.error{background:#f8d7da;color:#721c24}
.loading{background:#fff3cd;color:#856404}

/* MODAL */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  z-index:999;
}
.modal-content{
  background:#fff;
  width:420px;
  margin:10% auto;
  padding:25px;
  border-radius:10px;
}
.close{
  float:right;
  font-size:26px;
  cursor:pointer;
}
@media(max-width:600px){
  .modal-content{width:90%}
  .input-row{flex-direction:column}
}
</style>
</head>

<body>
<div class="container">
<h3>üìä Sistem Tebaran Nilai</h3>

<!-- LOGIN -->
<div class="login-section">
  <h4>üîê Login</h4>
  <div class="input-row">
    <input id="cariUser" placeholder="Username">
    <input id="cariPass" type="password" placeholder="Password">
  </div>
  <button id="cari" class="btn btn-cari" onclick="cariData()">üîç Cari Data</button>
</div>

<!-- MAIN -->
<div id="mainSection" class="input-section hidden">
  <h4>‚úèÔ∏è Data Nilai</h4>

  <textarea id="d" rows="4"></textarea>

  <div class="input-row">
    <input id="b" type="number" placeholder="Baris Sheet">
    <button class="btn btn-save" onclick="simpan()">üíæ Simpan</button>
    <button class="btn btn-modal" onclick="bukaModal()">üìù Modal</button>
  </div>

  <div id="h"></div>
</div>
</div>

<!-- MODAL -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="tutupModal()">&times;</span>
    <h3>üìù Form Jawaban</h3>

    <input id="mUser" placeholder="Username">
    <textarea id="mJawaban" rows="3"
      placeholder="BAB1|90|0|0|0|90"></textarea>

    <button class="btn btn-save" onclick="gabung()">Gabungkan</button>

    <div style="margin-top:10px;font-family:monospace" id="hasil">-</div>

    <div style="margin-top:15px;text-align:center">
      <button class="btn btn-save" onclick="simpanModal()">üíæ Simpan</button>
    </div>
  </div>
</div>

<script>
// ===== KONFIG =====
const SHEET_ID="1lueDGzRkaXb4XV0wnWlARF3OmkGnhIrP1Eg6fnBghf0";
const SHEET="Sheet1";
const GAS="https://script.google.com/macros/s/AKfycbwT8-GmTb270APXC4JZDyfd0BheuVf2SBuCh1vP4I3c5eeWmi86y7snEQc1AgUtcAymZg/exec";

let rowAktif="";

// ===== UTIL =====
function status(teks,tipe){
  const h=document.getElementById("h");
  h.className=tipe;
  h.innerHTML=teks;
}

// ===== LOGIN & CARI =====
async function cariData(){
  const u=cariUser.value.trim();
  const p=cariPass.value.trim();
  if(!u||!p) return status("‚ùå Login belum lengkap","error");

  status("üîç Mencari data...","loading");

  const q=`SELECT A,G WHERE CONTAINS(A,'${u}()${p}()')`;
  const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${SHEET}&tq=${encodeURIComponent(q)}`;

  const res=await fetch(url);
  const txt=await res.text();
  const json=JSON.parse(txt.replace(/.*setResponse\(|\);$/g,""));

  if(!json.table.rows.length){
    status("‚ùå Data tidak ditemukan","error");
    return;
  }

  const r=json.table.rows[0];
  d.value=r.c[0].v;
  b.value=r.c[1].v;
  rowAktif=b.value;

  mainSection.classList.remove("hidden");
  status("‚úÖ Data ditemukan","success");
}

// ===== SIMPAN =====
async function simpan(){
  if(!d.value||!b.value) return status("‚ùå Data belum lengkap","error");

  status("üì§ Menyimpan...","loading");

  const body=`baris=${b.value}&data=${encodeURIComponent(d.value)}`;
  const res=await fetch(GAS,{
    method:"POST",
    headers:{"Content-Type":"application/x-www-form-urlencoded"},
    body
  });

  status("‚úÖ Berhasil disimpan","success");
}

// ===== MODAL =====
function bukaModal(){
  modal.style.display="block";
  if(d.value){
    const [head,isi]=d.value.split("#");
    mUser.value=head.split("()")[0];
    mJawaban.value=isi||"";
  }
}
function tutupModal(){modal.style.display="none"}

function gabung(){
  if(!mUser.value||!mJawaban.value) return alert("Lengkapi data");
  hasil.textContent=`${mUser.value}()Login()${mUser.value}()XII-2()kode1#${mJawaban.value}`;
}

function simpanModal(){
  if(hasil.textContent=="-") return alert("Gabungkan dulu");
  d.value=hasil.textContent;
  simpan();
  tutupModal();
}
</script>
</body>
</html>

