<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LKPD PAI - Detail Materi Pembelajaran</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: #f5f7fa;
      color: #333;
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 25px;
      background: linear-gradient(135deg, #1a5f7a, #57cc99);
      color: white;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      color: #fff;
    }

    header h2 {
      font-size: 1.4rem;
      font-weight: 500;
      margin-bottom: 5px;
      color: #e3f2fd;
    }

    header h3 {
      font-size: 1.1rem;
      font-weight: 400;
      color: #caf0f8;
    }

    .controls {
      display: flex;
      justify-content: space-between;
      margin-bottom: 25px;
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      flex-wrap: wrap;
      gap: 15px;
    }

    .kelas-filter {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 12px 25px;
      background-color: #e3f2fd;
      color: #1a5f7a;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      font-size: 1rem;
    }

    .filter-btn:hover {
      background-color: #57cc99;
      color: white;
      transform: translateY(-2px);
    }

    .filter-btn.active {
      background-color: #1a5f7a;
      color: white;
    }

    .semester-filter {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .semester-btn {
      padding: 10px 20px;
      background-color: #f8f9fa;
      color: #495057;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .semester-btn:hover {
      background-color: #e9ecef;
      border-color: #57cc99;
    }

    .semester-btn.active {
      background-color: #57cc99;
      color: white;
      border-color: #57cc99;
    }

    .hierarchy {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 25px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .hierarchy h3 {
      color: #1a5f7a;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #57cc99;
    }

    .hierarchy-path {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 1.1rem;
    }

    .path-item {
      padding: 8px 15px;
      background-color: #e3f2fd;
      border-radius: 6px;
      font-weight: 600;
      color: #1a5f7a;
    }

    .path-separator {
      color: #57cc99;
      font-weight: bold;
    }

    .bab-tabs-container {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      margin-bottom: 30px;
    }

    .bab-tabs-header {
      display: flex;
      background-color: #1a5f7a;
      overflow-x: auto;
      scrollbar-width: thin;
    }

    .bab-tab-btn {
      padding: 18px 25px;
      background-color: transparent;
      color: rgba(255, 255, 255, 0.8);
      border: none;
      font-size: 1.2rem;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.3s;
      position: relative;
    }

    .bab-tab-btn:hover {
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
    }

    .bab-tab-btn.active {
      background-color: #57cc99;
      color: white;
    }

    .bab-tab-btn.active::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background-color: white;
    }

    .bab-tab-content {
      display: none;
      padding: 30px;
    }

    .bab-tab-content.active {
      display: block;
    }

    .bab-header {
      background-color: #f8f9fa;
      padding: 25px;
      border-radius: 10px;
      margin-bottom: 25px;
      border-left: 5px solid #57cc99;
    }

    .bab-title {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 10px;
    }

    .bab-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background-color: #1a5f7a;
      color: white;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      font-size: 1.8rem;
      font-weight: bold;
    }

    .bab-info {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 15px;
    }

    .info-item {
      background-color: #e3f2fd;
      padding: 8px 15px;
      border-radius: 6px;
      font-weight: 600;
      color: #1a5f7a;
    }

    .tujuan-pembelajaran {
      background-color: #e8f4fd;
      padding: 25px;
      border-radius: 10px;
      margin-bottom: 30px;
      border-left: 5px solid #1a5f7a;
    }

    .tujuan-pembelajaran h3 {
      color: #1a5f7a;
      margin-bottom: 15px;
      font-size: 1.4rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .tujuan-list {
      padding-left: 20px;
    }

    .tujuan-list li {
      margin-bottom: 10px;
      line-height: 1.8;
    }

    /* Aktivitas Tabs Styles */
    .aktivitas-tabs-container {
      margin-top: 20px;
    }

    .aktivitas-tabs-header {
      display: flex;
      background-color: #f1f1f1;
      border-radius: 8px 8px 0 0;
      overflow-x: auto;
      scrollbar-width: thin;
    }

    .aktivitas-tab-btn {
      padding: 15px 25px;
      background-color: transparent;
      color: #495057;
      border: none;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.3s;
      position: relative;
      min-width: 150px;
      text-align: center;
    }

    .aktivitas-tab-btn:hover {
      background-color: #e9ecef;
    }

    .aktivitas-tab-btn.active {
      background-color: white;
      color: #1a5f7a;
    }

    .aktivitas-tab-btn.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background-color: #57cc99;
    }

    .aktivitas-tab-content {
      display: none;
      padding: 30px;
      background-color: white;
      border-radius: 0 0 8px 8px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
      min-height: 400px;
    }

    .aktivitas-tab-content.active {
      display: block;
    }

    .aktivitas-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }

    .aktivitas-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background-color: #57cc99;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-weight: bold;
      font-size: 1.2rem;
    }

    .aktivitas-name {
      font-size: 1.4rem;
      color: #1a5f7a;
      font-weight: 600;
    }

    .aktivitas-content {
      line-height: 1.8;
      font-size: 1.1rem;
    }

    .aktivitas-content img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin: 15px 0;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }

    .aktivitas-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }

    .aktivitas-content th, .aktivitas-content td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }

    .aktivitas-content th {
      background-color: #f1f1f1;
      font-weight: 600;
    }

    .footer-info {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #ddd;
      color: #666;
      font-size: 0.95rem;
    }

    .loading {
      text-align: center;
      padding: 50px;
      font-size: 1.3rem;
      color: #1a5f7a;
    }

    .error {
      text-align: center;
      padding: 30px;
      background-color: #ffebee;
      color: #c62828;
      border-radius: 10px;
      margin: 20px 0;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }

    .empty-state i {
      font-size: 4rem;
      color: #ccc;
      margin-bottom: 20px;
    }

    .empty-state h3 {
      font-size: 1.5rem;
      margin-bottom: 10px;
      color: #888;
    }

    footer {
      text-align: center;
      margin-top: 40px;
      padding: 25px;
      color: #666;
      border-top: 1px solid #ddd;
    }

    /* STYLE UNTUK SOAL PILIHAN GANDA */
    .quiz-container {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      padding: 25px;
      margin-top: 20px;
    }

    .quiz-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid #e6f0ff;
    }

    .quiz-title {
      font-size: 1.5rem;
      color: #1a5f7a;
      font-weight: 600;
    }

    .quiz-area {
      display: flex;
      min-height: 500px;
    }

    .question-container {
      flex: 3;
      padding-right: 30px;
      border-right: 2px solid #e6f0ff;
    }

    .navigation-container {
      flex: 1;
      padding-left: 30px;
    }

    .question-text {
      font-size: 1.3rem;
      margin-bottom: 25px;
      color: #1a365d;
      line-height: 1.7;
      padding-bottom: 15px;
      border-bottom: 1px dashed #e6f0ff;
    }

    .options-container {
      margin: 25px 0;
    }

    .option {
      padding: 15px 20px;
      margin-bottom: 12px;
      background-color: #f8fbff;
      border: 2px solid #d6e4ff;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 1.1rem;
    }

    .option:hover {
      background-color: #e6f0ff;
      transform: translateY(-2px);
    }

    .option.selected {
      background-color: #d4edda;
      border-color: #28a745;
      color: #155724;
      font-weight: 600;
    }

    .navigation-title {
      text-align: center;
      margin-bottom: 20px;
      color: #1a5f7a;
      font-size: 1.3rem;
      padding-bottom: 10px;
      border-bottom: 2px solid #e6f0ff;
    }

    .question-nav {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    .nav-item {
      width: 45px;
      height: 45px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #e6f0ff;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s ease;
      border: 2px solid transparent;
    }

    .nav-item:hover {
      background-color: #c2d9ff;
    }

    .nav-item.active {
      background-color: #1a5f7a;
      color: white;
      border-color: #1a5f7a;
    }

    .nav-item.answered {
      background-color: #28a745;
      color: white;
    }

    .quiz-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 2px solid #e6f0ff;
    }

    .quiz-button {
      padding: 14px 28px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .prev-btn {
      background-color: #6c757d;
      color: white;
    }

    .prev-btn:hover {
      background-color: #5a6268;
    }

    .next-btn {
      background-color: #1a5f7a;
      color: white;
    }

    .next-btn:hover {
      background-color: #15539e;
    }

    .submit-btn {
      background-color: #28a745;
      color: white;
      display: none;
    }

    .submit-btn:hover {
      background-color: #218838;
    }

    .progress-container {
      margin-top: 20px;
      padding: 15px;
      background-color: #f8fbff;
      border-radius: 10px;
    }

    .progress-text {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .progress-bar {
      height: 10px;
      background-color: #e6f0ff;
      border-radius: 5px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(to right, #1a5f7a, #57cc99);
      width: 0%;
      transition: width 0.5s ease;
    }

    /* Modal hasil */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: white;
      padding: 30px;
      border-radius: 15px;
      width: 90%;
      max-width: 500px;
      max-height: 80%;
      overflow-y: auto;
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #e6f0ff;
    }

    .modal-title {
      font-size: 1.8rem;
      color: #1a5f7a;
    }

    .close-modal {
      background: none;
      border: none;
      font-size: 2rem;
      cursor: pointer;
      color: #999;
      padding: 0;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-body {
      margin-bottom: 25px;
    }

    .result-summary {
      background-color: #e6f0ff;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
      text-align: center;
    }

    .result-score {
      font-size: 1.8rem;
      text-align: center;
      font-weight: bold;
      color: #1a5f7a;
      margin: 10px 0;
    }

    .result-output {
      background-color: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      font-family: monospace;
      word-break: break-all;
      font-size: 1.1rem;
    }

    .info-lkpd {
      background: #f8fafc;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      padding: 16px 20px;
      max-width: 600px;
      font-family: Arial, Helvetica, sans-serif;
      margin-bottom: 20px;
    }

    .info-lkpd .row {
      display: grid;
      grid-template-columns: 160px 1fr;
      padding: 6px 0;
      border-bottom: 1px dashed #e5e7eb;
    }

    .info-lkpd .row:last-child {
      border-bottom: none;
    }

    .info-lkpd .label {
      font-weight: 600;
      color: #1e3a8a;
    }

    .info-lkpd .value {
      color: #111827;
    }

    .info-lkpd .batas .value {
      color: #b91c1c;
      font-weight: bold;
    }

    @media (max-width: 992px) {
      .controls {
        flex-direction: column;
      }

      .kelas-filter, .semester-filter {
        justify-content: center;
      }

      .bab-tabs-header {
        flex-wrap: wrap;
      }

      .bab-tab-btn {
        flex: 1;
        min-width: 120px;
        text-align: center;
      }

      .aktivitas-tabs-header {
        flex-wrap: wrap;
      }

      .aktivitas-tab-btn {
        flex: 1;
        min-width: 120px;
      }

      .quiz-area {
        flex-direction: column;
      }

      .question-container {
        border-right: none;
        border-bottom: 2px solid #e6f0ff;
        padding-right: 0;
        margin-bottom: 30px;
      }

      .navigation-container {
        padding-left: 0;
      }
    }

    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }

      header h1 {
        font-size: 2rem;
      }

      header h2 {
        font-size: 1.2rem;
      }

      .bab-number {
        width: 50px;
        height: 50px;
        font-size: 1.5rem;
      }

      .aktivitas-tab-content {
        padding: 15px;
        min-height: 300px;
      }

      .aktivitas-tab-btn {
        padding: 12px 15px;
        font-size: 1rem;
        min-width: 100px;
      }

      .bab-tab-btn {
        padding: 15px;
        font-size: 1rem;
      }

      .bab-info {
        flex-direction: column;
        gap: 10px;
      }

      .footer-info {
        flex-direction: column;
        gap: 10px;
      }
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: #57cc99;
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #1a5f7a;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-book-open"></i> LKPD PENDIDIKAN AGAMA ISLAM</h1>
      <h2>DETAIL MATERI PEMBELAJARAN SMA/SMK</h2>
      <h3>Kurikulum Merdeka - Platform Pembelajaran Digital</h3>
    </header>

    <div class="controls">
      <div class="kelas-filter">
        <span style="font-weight: 600; color: #1a5f7a; align-self: center; margin-right: 10px;">Pilih Kelas:</span>
        <button class="filter-btn active" data-kelas="all">Semua Kelas</button>
        <button class="filter-btn" data-kelas="X">Kelas X</button>
        <button class="filter-btn" data-kelas="XI">Kelas XI</button>
        <button class="filter-btn" data-kelas="XII">Kelas XII</button>
      </div>

      <div class="semester-filter">
        <span style="font-weight: 600; color: #1a5f7a; margin-right: 10px;">Pilih Semester:</span>
        <button class="semester-btn active" data-semester="all">Semua Semester</button>
        <button class="semester-btn" data-semester="1">Semester 1</button>
        <button class="semester-btn" data-semester="2">Semester 2</button>
      </div>
    </div>

    <div id="loading" class="loading">
      <i class="fas fa-spinner fa-spin"></i> Memuat data materi...
    </div>

    <div id="error-message" class="error" style="display: none;">
      <p>Gagal memuat data materi. Pastikan file <strong>materi.json</strong> tersedia.</p>
      <p>Data yang ditampilkan saat ini adalah contoh data.</p>
    </div>

    <div id="emptyState" class="empty-state" style="display: none;">
      <i class="fas fa-book"></i>
      <h3>Tidak Ada Materi yang Ditemukan</h3>
      <p>Silakan pilih kelas dan semester untuk menampilkan materi.</p>
    </div>

    <div id="babTabsContainer" class="bab-tabs-container" style="display: none;">
      <div class="bab-tabs-header" id="babTabsHeader"></div>
      <div id="babTabsContent"></div>
    </div>

    <footer>
      <p>LKPD Pendidikan Agama Islam - SMA/SMK &copy; 2023</p>
      <p>Sistem Manajemen Pembelajaran Digital Berbasis Kurikulum Merdeka</p>
    </footer>
  </div>

  <!-- Modal untuk hasil quiz -->
  <div class="modal" id="resultModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Hasil Quiz Anda</h2>
        <button class="close-modal" id="closeModal">&times;</button>
      </div>
      
      <div class="modal-body">
        <div id="resultsContainer"></div>
        
        <div class="result-summary">
          <h3>Ringkasan Hasil</h3>
          <div class="result-score" id="finalScore">0/10</div>
          <p>Format jawaban untuk disimpan:</p>
          <div class="result-output" id="resultOutput"></div>
          <button id="copyBtn" class="quiz-button" style="margin-top: 15px; background-color: #1a5f7a;">Salin Hasil</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const loadingElement = document.getElementById('loading');
      const errorElement = document.getElementById('error-message');
      const emptyStateElement = document.getElementById('emptyState');
      const babTabsContainer = document.getElementById('babTabsContainer');
      const babTabsHeader = document.getElementById('babTabsHeader');
      const babTabsContent = document.getElementById('babTabsContent');

      const filterButtons = document.querySelectorAll('.filter-btn');
      const semesterButtons = document.querySelectorAll('.semester-btn');

      // Data contoh jika file JSON tidak ditemukan
      const contohData = [
        {
          "bab": "BAB 6",
          "judul": "Cinta Tanah Air dan Moderasi Beragama",
          "aktivitas_1": "<img src=\"https://drive.google.com/thumbnail?id=1MydJXE22rWeNHBq2FpvMVx3r8mAmXI1p&sz=w1000\" alt=\"Ilustrasi\" loading=\"lazy\" style=\"max-width: 100%; height: auto;\">__KUNCI__ ini adalah kunci jawaban dari aktivitas 1",
          "aktivitas_2": "Amati gambar di bawah ini, kemudian jelaskan makna yang tersirat dalam gambar tersebut! <br> <img src=\"https://drive.google.com/thumbnail?id=1dwlzu56bdBpaJCPn-zamUMUO5xwzkmdV&sz=w1000\" alt=\"Ilustrasi\" loading=\"lazy\" style=\"max-width: 100%; height: auto;\">__KUNCI__ ini adalah kunci jawaban dari aktivitas 2",
          "aktivitas_3": "<html><body style=\"margin:0; padding:0;\"><br><table style=\"border:1px solid #000;\" ><tr><br><td colspan=\"4\" style=\"border:1px solid #000; vertical-align:top;\"><h2 style=\"text-align:center;\">LKPD Deep Learning</h2><br><p><strong>Materi:</strong> Cinta Tanah Air & Moderasi Beragama</p></td></tr><br><tr><br><td colspan=4><br><strong>Identitas Peserta Didik</strong><br><br>Nama : .....................................................<br><br>Kelas : .....................................................<br><br>Tanggal : ...................................................<br></td><br></tr><br><tr><br><th style=\"border:1px solid #000;\">No</th><br><th style=\"border:1px solid #000;\">Aspek Deep Learning</th><br><th style=\"border:1px solid #000;\">Panduan Jawaban</th><br><th style=\"border:1px solid #000;\">Jawaban Peserta Didik</th><br></tr><br><br><tr><br><td style=\"border:1px solid #000; text-align:center;\">1</td><br><td style=\"border:1px solid #000;\">Permasalahan Nyata</td><br><td style=\"border:1px solid #000;\">Masalah terkait cinta tanah air atau moderasi beragama di lingkungan sekitar</td><br><td style=\"border:1px solid #000; height:70px;\"></td><br></tr><br><br><tr><br><td style=\"border:1px solid #000; text-align:center;\">2</td><br><td style=\"border:1px solid #000;\">Fakta yang Terjadi</td><br><td style=\"border:1px solid #000;\">Peristiwa yang benar-benar terjadi (tanpa opini)</td><br><td style=\"border:1px solid #000; height:70px;\"></td><br></tr><br><br><tr><br><td style=\"border:1px solid #000; text-align:center;\">3</td><br><td style=\"border:1px solid #000;\">Penyebab Masalah</td><br><td style=\"border:1px solid #000;\">Alasan atau faktor penyebab terjadinya masalah</td><br><td style=\"border:1px solid #000; height:70px;\"></td><br></tr><br><br><tr><br><td style=\"border:1px solid #000; text-align:center;\">4</td><br><td style=\"border:1px solid #000;\">Nilai yang Dilanggar</td><br><td style=\"border:1px solid #000;\">Nilai Pancasila, agama, atau kebangsaan yang tidak dijalankan</td><br><td style=\"border:1px solid #000; height:70px;\"></td><br></tr><br><br><tr><br><td style=\"border:1px solid #000; text-align:center;\">5</td><br><td style=\"border:1px solid #000;\">Dampak yang Ditimbulkan</td><br><td style=\"border:1px solid #000;\">Dampak bagi diri sendiri, orang lain, dan bangsa</td><br><td style=\"border:1px solid #000; height:70px;\"></td><br></tr><br><br><tr><br><td style=\"border:1px solid #000; text-align:center;\">6</td><br><td style=\"border:1px solid #000;\">Sikap yang Seharusnya</td><br><td style=\"border:1px solid #000;\">Sikap cinta tanah air dan moderasi beragama yang tepat</td><br><td style=\"border:1px solid #000; height:70px;\"></td><br></tr><br><br><tr><br><td style=\"border:1px solid #000; text-align:center;\">7</td><br><td style=\"border:1px solid #000;\">Solusi Nyata</td><br><td style=\"border:1px solid #000;\">Solusi realistis yang bisa dilakukan pelajar</td><br><td style=\"border:1px solid #000; height:70px;\"></td><br></tr><br><br><tr><br><td style=\"border:1px solid #000; text-align:center;\">8</td><br><td style=\"border:1px solid #000;\">Komitmen Pribadi</td><br><td style=\"border:1px solid #000;\">Perubahan sikap atau tindakan yang akan dilakukan</td><br><td style=\"border:1px solid #000; height:70px;\"></td><br></tr><br><tr ><br><td colspan=4><br><strong>Refleksi Individu</strong><br><br>Setelah mengerjakan LKPD ini, pemahaman atau sikap apa yang berubah dalam dirimu?<br><br><br>......................................................................................................................<br><br>......................................................................................................................<br></td><br></tr><br></table></body><br></html>__KUNCI__ ini adalah kunci jawaban dari aktivitas 1",
          "aktivitas_4": "<h2>Refleksikan Pemahamanmu terkait materi</h2><br><ol><br><li>Setelah mempelajari materi Q.S. al-Qasas/28: 85 tentang cinta tanah air dan Q.S. al-Baqarah/2: 143 tentang moderasi beragama, coba kalian analisis penerapannya dalam kehidupan sehari-hari!</li><br><li>Tuliskan penerapan cinta tanah air dalam kehidupan nyata! </li><br><ol type=\"a\"><br><li>.................................</li><br><li>.................................</li><br><li>.................................</li><br></ol> <br><br></ol> __KUNCI__ ini adalah kunci jawaban dari aktivitas 1",
          "aktivitas_5": "()1#<br>Budiono yang berdomisili di lingkungan <br>perumahan setiap kali ada perintah untuk <br>mengibarkan bendera merah putih pada <br>saat peringatan hari besar nasional, beliau <br>selalu taat dan patuh melaksanakan dengan <br>penuh kesadaran.#<br>Kebhinekaan Global, <br>Mandiri ()2#<br>Awaludin setelah pulang dari merantau, <br>menyadari perilakunya selama ini yang <br>tidak peduli terhadap lingkungan di mana <br>ia bertempat tinggal, tetapi akhir – akhir <br>ini ia selalu rajin membantu tetangga dan <br>lingkungan ketika ada kegiatan-kegiatan <br>sosial kemasyarakatan.#<br>Bergotong Royong()3#<br>Rumah pak Ridlo yang berada di lereng <br>gunung tertimbun oleh longsor yang <br>datang secara tiba-tiba. Beliau tetap tegar <br>dan berusaha membersihkan puing-puing rumahnya dibantu oleh tim SAR dan <br>masyarakat setempat untuk mendirikan <br>rumahnya kembali#<br>Mandiri, Bergotong <br>Royong()4#<br>Parmin walau seorang tukang becak <br>yang biasa mangkal di depan alun-alun <br>kota untuk mendapatkan penumpang <br>tetap setia menunggu penumpang sambil <br>bentar-bentar membukan kertas kecil <br>yang terselip disakunya yang ternyata Al-Qur'annya. Saat suara adzan berkumandang <br>beliau segera menuju masjid dan dengan <br>sesama tukang becak yang beda agama <br>beliau selalu bersikap baik#<br>Mandiri, Religius() 5#<br>Aditya sangat bahagia ketika pak Kadus <br>memberikan bantuan berupa sembako <br>akibat pandemi covid 19 karena beliau tahu <br>betul pak Kadus tidak membeda-bedakan <br>warganya.#<br>Kebhinekaan Global,<br>__KUNCI__ ini adalah kunci jawaban dari aktivitas 5",
          "aktivitas_6": "<div class='quiz-container'><div class='quiz-header'><h2 class='quiz-title'>Soal Pilihan Ganda</h2><div><span id='quizProgress'>Soal 1 dari 10</span></div></div><div class='quiz-area'><div class='question-container'><div class='question-text' id='questionText'></div><div class='options-container' id='optionsContainer'></div><div class='quiz-buttons'><button class='quiz-button prev-btn' id='prevBtn'>Sebelumnya</button><button class='quiz-button next-btn' id='nextBtn'>Selanjutnya</button><button class='quiz-button submit-btn' id='submitBtn'>Kumpulkan Jawaban</button></div><div class='progress-container'><div class='progress-text'><span>Progress</span><span id='progressPercent'>0%</span></div><div class='progress-bar'><div class='progress-fill' id='progressFill'></div></div></div></div><div class='navigation-container'><h3 class='navigation-title'>Navigasi Soal</h3><div class='question-nav' id='questionNav'></div><div class='progress-container' style='margin-top: 30px;'><div class='progress-text'><span>Status Jawaban</span></div><div style='display: flex; gap: 15px; margin-top: 15px;'><div style='display: flex; align-items: center; gap: 5px;'><div style='width: 20px; height: 20px; background-color: #28a745; border-radius: 4px;'></div><span>Terjawab</span></div><div style='display: flex; align-items: center; gap: 5px;'><div style='width: 20px; height: 20px; background-color: #1a5f7a; border-radius: 4px;'></div><span>Aktif</span></div></div></div></div></div></div>",
          "batas": "2025-12-19 00:00:00",
          "tujuan_pembelajaran": "1) Membaca Q.S. al-Qasas : 85 dan Q.S. al-Baqarah : 143 serta hadis tentang cinta tanah air dan moderasi beragama.,2) analisis tajwid al-Qasas 28.: 85 dan Q.S. al-Baqarah2.: 143., 3) Mendeskripsikan arti perkata dan al-Qasas 28.: 85 dan Q.S. al-Baqarah2.: 143 , 4. Mendeskripsikan tafsir Q.S. al-Qasas 28.: 85 dan Q.S. al-Baqarah2.: 143., 5. Memberikan contoh sikap yang harus dimiliki sebagai wujud cinta tanah air dan moderasi beragama., 6. Mengambil hikmah wujud cinta tanah air dan moderasi dalam beragama.",
          "kelas": "XII-2/6",
          "soal_pg": "Perhatikan kutipan ayat Q.S. al-Qasas/28: 85 berikut<img src=\"https://drive.google.com/thumbnail?id=1R8rCN2QG3cRztylhm1KbPe2RFXihM-us&sz=w1000\" alt=\"Ilustrasi\" loading=\"lazy\" style=\"max-width: 100%; height: auto;\"> Arti ayat yang bergaris pada potongan ayat di atas adalah ..|sesungguhnya (Allah) yang mewajibkan|kami sungguh melarang kamu|sesungguhnya wajib bagimu|kami memerintahkanmu|kamu diperintahkan|B_#_Perhatikan kutipan ayat Q.S. al-Qasas/28: 85 berikut <img src=\"https://drive.google.com/thumbnail?id=1R8rCN2QG3cRztylhm1KbPe2RFXihM-us&sz=w1000\" alt=\"Ilustrasi\" loading=\"lazy\" style=\"max-width: 100%; height: auto;\"></br> Bacaan tajwid potongan ayat di atas adalah ..|Mad jaiz munfasil, mad iwadl, mad thabi'i|Mad jaiz munfasil, ikhfa', mad wajib mutasil|Mad jaiz munfasil, ikhfa', mad thabi'i|Mad badal, mad iwadl, mad thabi'i|Mad badal, mad iwadl, mad lain|C_#_Perhatikan kutipan ayat Q.S. al-Baqarah/2: 143 berikut <img src=\"https://drive.google.com/thumbnail?id=1-X2AB6EvmDEGQHX9oT4Kvtv76RF9qRg9&sz=w1000\" alt=\"Ilustrasi\" loading=\"lazy\" style=\"max-width: 100%; height: auto;\"></br> Arti ayat yang bergaris pada potongan ayat di atas adalah ..|dan demikian pula Kami telah menjadikan kamu (umat Islam) umat pertengahan|dan demikian pula Kami telah menciptakan kamu (umat Islam) umat yang terbaik|dan demikian pula Kami telah memerintahkan kamu (umat Islam) berbuat baik|dan demikian pula Kami telah menciptakan kamu (umat Islam) umat bersuku-suku|dan demikian pula Kami telah menciptakan kamu (umat Islam) umat berbangsa-bangsa|A_#_Perhatikan kutipan ayat Q.S. al-Baqarah/2: 143 berikut <img src=\"https://drive.google.com/thumbnail?id=1R8rCN2QG3cRztylhm1KbPe2RFXihM-us&sz=w1000\" alt=\"Ilustrasi\" loading=\"lazy\" style=\"max-width: 100%; height: auto;\"><br> Bacaan tajwid potongan ayat di atas adalah ..|Mad jaiz munfasil, mad iwadl, mad thabi'i, mad badal|Mad thabi'i, al qamariyah, al syamsiyah, ikhfa' mad jaiz mumfasil|Mad jaiz munfasil, ikhfa', mad thabi'i, idhar syafawi|Mad badal, mad iwadl, mad thabi'i, iqlab|Mad badal, mad iwadl, mad lain|E_#_Perhatikan kutipan ayat Q.S. al-Baqarah/2: 143 berikut!<img src=\"https://drive.google.com/thumbnail?id=1R8rCN2QG3cRztylhm1KbPe2RFXihM-us&sz=w1000\" alt=\"Ilustrasi\" loading=\"lazy\" style=\"max-width: 100%; height: auto;\"><br> Bacaan tajwid potongan ayat di atas adalah ….|Mad jaiz munfasil, mad iwadl, mad thabi'i, mad badal|Mad thabi'i, al qamariyah, al syamsiyah, ikhfa' mad jaiz mumfasil|Mad jaiz munfasil, ikhfa', mad thabi'i, idhar syafawi|Mad badal, mad iwadl, mad thabi'i, iqlab|Ikhfa', mad thabi'i, idhar, al qamariyah|D_#_Perhatikan pernyataan di bawah ini! 1) Bangga sebagai bangsa Indonesia 2) Menjual nama baik tanah air Indonesia 3) Menggunakan hak pilih dalam pemilu 4) Menjunjung tinggi hukum jika perlu 5) Aktif berpartisipasi dalam pembangunan nasional. Pernyataan tersebut merupakan contoh sikap cinta tanah air adalah nomor ..|1), 2) dan 3)|1), 2) dan 4)|1), 2) dan 5)|1), 3) dan 5)|1), 4) dan 5)|D_#_Berikut ini yang bukan contoh sikap cinta tanah air yang bisa kita lakukan dalam kegiatan sehari-hari adalah ..|Menuntut ilmu dengan sungguh-sungguh|Melestarikan kebudayaan Indonesia|Menjaga kelestarian lingkungan|Menciptakan kerukunan antar umat beragama|Hidup rukun dan gotong royong jika jadi tokoh masyarakat|A_#_Allah Swt. berfirman, \"...agar Kami dapat menjadikan kalian sebagai umat pilihan...\". Yang dimaksud dengan kata 'wasath' adalah ….|pilihan yang terbaik|pilihan yang menyenangkan|pilihan yang menyedihkan|pilihan yang melapangkan|pilihan yang terlupakan|E_#_Hal ini dikembangkan oleh Kemendikbud dan Kemenag dengan mengusung tema ..|merdeka sebebas bebasnya|merdeka sesuai kebutuhan|profil pelajar Pancasila|profil guru professional|profil tenaga kependidikan|C_#_Karakter dan prinsip wasath seseorang hendaknya memegang prinsip berada dalam jalan yang lurus, hal ini dapat difahami sebagai wujud sikap ..|tasamuh|tawasul|tawazun|tawakal|istiqamah|B"
        }
      ];

      let allData = [];
      let filteredData = [];
      let selectedKelas = 'all';
      let selectedSemester = 'all';

      // Variabel untuk sistem quiz
      let currentQuestion = 0;
      let userAnswers = [];
      let quizData = [];
      let userName = "";
      
      // Elemen modal
      const resultModal = document.getElementById('resultModal');
      const closeModal = document.getElementById('closeModal');
      const finalScore = document.getElementById('finalScore');
      const resultOutput = document.getElementById('resultOutput');
      const copyBtn = document.getElementById('copyBtn');

      // Fungsi untuk memuat data dari JSON
      async function loadData() {
        try {
          const response = await fetch('materi.json');
          
          if (!response.ok) {
            throw new Error('File tidak ditemukan');
          }
          
          const data = await response.json();
          allData = data;
          
          // Sembunyikan loading
          loadingElement.style.display = 'none';
          
          // Tampilkan data
          applyFilters();
          
        } catch (error) {
          console.error('Error loading JSON:', error);
          
          // Gunakan data contoh jika gagal
          allData = contohData;
          
          // Tampilkan pesan error
          loadingElement.style.display = 'none';
          errorElement.style.display = 'block';
          
          // Tampilkan data contoh
          applyFilters();
        }
      }

      // Fungsi untuk mengekstrak informasi kelas dan semester dari string kelas
      function parseKelasInfo(kelasStr) {
        // Format: "XII-1/1", "X-1/2", "XI-2/6"
        const match = kelasStr.match(/(X|XI|XII)-(\d+)\/(\d+)/);
        if (match) {
          return {
            kelas: match[1],
            semester: parseInt(match[2]),
            bab: parseInt(match[3])
          };
        }
        return { kelas: "", semester: 0, bab: 0 };
      }

      // Fungsi untuk memfilter data berdasarkan kelas dan semester
      function filterData() {
        if (selectedKelas === 'all' && selectedSemester === 'all') {
          return allData;
        } else if (selectedKelas === 'all') {
          return allData.filter(item => {
            const info = parseKelasInfo(item.kelas);
            return info.semester == selectedSemester;
          });
        } else if (selectedSemester === 'all') {
          return allData.filter(item => {
            const info = parseKelasInfo(item.kelas);
            return info.kelas === selectedKelas;
          });
        } else {
          return allData.filter(item => {
            const info = parseKelasInfo(item.kelas);
            return info.kelas === selectedKelas && info.semester == selectedSemester;
          });
        }
      }

      // Fungsi untuk membuat konten tab bab
      function createBabTabContent(babData) {
        const babNumber = babData.bab;
        const kelasInfo = parseKelasInfo(babData.kelas);
        
        let html = `
        <div class="tujuan-pembelajaran">
          <div class="info-lkpd">
            <div class="row">
              <span class="label">Mata Pelajaran</span>
              <span class="value">Pendidikan Agama Islam</span>
            </div>
            <div class="row">
              <span class="label">Kelas / Semester</span>
              <span class="value">${kelasInfo.kelas} / ${kelasInfo.semester}</span>
            </div>
            <div class="row">
              <span class="label">Bab / Materi</span>
              <span class="value">${babData.bab} / ${babData.judul}</span>
            </div>
            <div class="row batas">
              <span class="label">Batas Waktu</span>
              <span class="value">${formatDate(babData.batas)}</span>
            </div>
          </div>
          
          <h3><i class="fas fa-bullseye"></i> Tujuan Pembelajaran</h3>
          <div class="tujuan-list">
        `;
        
        // Format tujuan pembelajaran
        const tujuanItems = babData.tujuan_pembelajaran.split(',').map(item => item.trim());
        tujuanItems.forEach(item => {
          if (item) {
            html += `<li>${item}</li>`;
          }
        });
        
        html += `
          </div>
        </div>
        
        <div class="aktivitas-tabs-container" id="aktivitasTabs-${babNumber}">
          <div class="aktivitas-tabs-header" id="aktivitasTabsHeader-${babNumber}"></div>
          <div id="aktivitasTabsContent-${babNumber}"></div>
        </div>
        
        <div class="footer-info">
          <div><i class="fas fa-info-circle"></i> ${babNumber} - Kelas ${kelasInfo.kelas} Semester ${kelasInfo.semester}</div>
          <div><i class="fas fa-calendar-check"></i> Batas Pengumpulan: ${formatDate(babData.batas)}</div>
        </div>
        `;
        
        return html;
      }

      // Fungsi untuk membuat tab aktivitas
      function createAktivitasTabs(babData, babNumber) {
        const aktivitasTabsHeader = document.getElementById(`aktivitasTabsHeader-${babNumber}`);
        const aktivitasTabsContent = document.getElementById(`aktivitasTabsContent-${babNumber}`);
        
        if (!aktivitasTabsHeader || !aktivitasTabsContent) return;
        
        aktivitasTabsHeader.innerHTML = "";
        aktivitasTabsContent.innerHTML = "";
        
        // Buat tab untuk setiap aktivitas (1-6, yang ke-6 untuk soal pilihan ganda)
        for (let i = 1; i <= 6; i++) {
          const aktivitasKey = `aktivitas_${i}`;
          let aktivitasTitle = `Aktivitas ${i}`;
          
          // Jika ada soal pilihan ganda, beri judul khusus
          if (i === 6 && babData.soal_pg) {
            aktivitasTitle = "Soal Pilihan Ganda";
          }
          
          if (babData[aktivitasKey] || (i === 6 && babData.soal_pg)) {
            const aktivitasId = `aktivitas-${babNumber.replace(' ', '-')}-${i}`;
            
            // Buat tombol tab aktivitas
            const aktivitasTabButton = document.createElement('button');
            aktivitasTabButton.className = `aktivitas-tab-btn ${i === 1 ? 'active' : ''}`;
            aktivitasTabButton.id = `btn-${aktivitasId}`;
            aktivitasTabButton.textContent = aktivitasTitle;
            aktivitasTabButton.addEventListener('click', () => switchAktivitasTab(aktivitasId, babNumber, babData));
            aktivitasTabsHeader.appendChild(aktivitasTabButton);
            
            // Buat konten tab aktivitas
            const aktivitasTabContent = document.createElement('div');
            aktivitasTabContent.className = `aktivitas-tab-content ${i === 1 ? 'active' : ''}`;
            aktivitasTabContent.id = aktivitasId;
            
            // Jika ini adalah tab soal pilihan ganda (aktivitas 6)
            if (i === 6 && babData.soal_pg) {
              // Inisialisasi sistem quiz
              initializeQuizSystem(babData.soal_pg);
              
              // Buat konten quiz
              aktivitasTabContent.innerHTML = createQuizContent();
              
              // Setelah konten dibuat, inisialisasi quiz
              setTimeout(() => {
                if (userAnswers.length === 0) {
                  userAnswers = new Array(quizData.length).fill(null);
                }
                loadQuestion();
                createNavigation();
                updateProgress();
                updateButtons();
                
                // Minta nama pengguna jika belum ada
                if (!userName) {
                  userName = prompt("Masukkan nama Anda untuk quiz:", "Peserta") || "Peserta";
                }
              }, 100);
            } else {
              aktivitasTabContent.innerHTML = createAktivitasContent(babData[aktivitasKey], i);
            }
            
            aktivitasTabsContent.appendChild(aktivitasTabContent);
          }
        }
      }

      // Fungsi untuk membuat konten aktivitas
      function createAktivitasContent(aktivitasContent, aktivitasNumber) {
        return `
          <div class="aktivitas-header">
            <div class="aktivitas-number">${aktivitasNumber}</div>
            <div class="aktivitas-name">Aktivitas ${aktivitasNumber}</div>
          </div>
          <div class="aktivitas-content">
            ${aktivitasContent}
          </div>
        `;
      }
      
      // Fungsi untuk membuat konten quiz
      function createQuizContent() {
        return `
          <div class="quiz-container">
            <div class="quiz-header">
              <h2 class="quiz-title">Soal Pilihan Ganda</h2>
              <div><span id="quizProgress">Soal 1 dari ${quizData.length}</span></div>
            </div>
            <div class="quiz-area">
              <div class="question-container">
                <div class="question-text" id="questionText"></div>
                <div class="options-container" id="optionsContainer"></div>
                <div class="quiz-buttons">
                  <button class="quiz-button prev-btn" id="prevBtn">Sebelumnya</button>
                  <button class="quiz-button next-btn" id="nextBtn">Selanjutnya</button>
                  <button class="quiz-button submit-btn" id="submitBtn">Kumpulkan Jawaban</button>
                </div>
                <div class="progress-container">
                  <div class="progress-text">
                    <span>Progress</span>
                    <span id="progressPercent">0%</span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                  </div>
                </div>
              </div>
              <div class="navigation-container">
                <h3 class="navigation-title">Navigasi Soal</h3>
                <div class="question-nav" id="questionNav"></div>
                <div class="progress-container" style="margin-top: 30px;">
                  <div class="progress-text">
                    <span>Status Jawaban</span>
                  </div>
                  <div style="display: flex; gap: 15px; margin-top: 15px;">
                    <div style="display: flex; align-items: center; gap: 5px;">
                      <div style="width: 20px; height: 20px; background-color: #28a745; border-radius: 4px;"></div>
                      <span>Terjawab</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px;">
                      <div style="width: 20px; height: 20px; background-color: #1a5f7a; border-radius: 4px;"></div>
                      <span>Aktif</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
      }

      // Fungsi untuk memformat tanggal
      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('id-ID', {
          day: '2-digit',
          month: 'long',
          year: 'numeric'
        });
      }

      // Fungsi untuk membuat tab bab
      function createBabTabs() {
        babTabsHeader.innerHTML = "";
        babTabsContent.innerHTML = "";
        
        if (filteredData.length === 0) {
          babTabsContainer.style.display = 'none';
          emptyStateElement.style.display = 'block';
          return;
        }
        
        babTabsContainer.style.display = 'block';
        emptyStateElement.style.display = 'none';
        
        // Buat tab untuk setiap bab
        filteredData.forEach((babData, index) => {
          const babNumber = babData.bab;
          const kelasInfo = parseKelasInfo(babData.kelas);
          const tabId = `tab-${kelasInfo.kelas}-${kelasInfo.semester}-${kelasInfo.bab}`;
          
          // Buat tombol tab bab
          const tabButton = document.createElement('button');
          tabButton.className = `bab-tab-btn ${index === 0 ? 'active' : ''}`;
          tabButton.id = `btn-${tabId}`;
          tabButton.textContent = babNumber;
          tabButton.addEventListener('click', () => {
            switchBabTab(tabId);
            // Setelah mengganti tab bab, buat tab aktivitas untuk bab tersebut
            createAktivitasTabs(babData, babNumber);
          });
          
          babTabsHeader.appendChild(tabButton);
          
          // Buat konten tab bab
          const tabContent = document.createElement('div');
          tabContent.className = `bab-tab-content ${index === 0 ? 'active' : ''}`;
          tabContent.id = tabId;
          tabContent.innerHTML = createBabTabContent(babData);
          babTabsContent.appendChild(tabContent);
        });
        
        // Buat tab aktivitas untuk bab pertama
        if (filteredData.length > 0) {
          createAktivitasTabs(filteredData[0], filteredData[0].bab);
        }
      }

      // Fungsi untuk mengganti tab bab
      function switchBabTab(tabId) {
        // Nonaktifkan semua tab bab
        document.querySelectorAll('.bab-tab-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        document.querySelectorAll('.bab-tab-content').forEach(content => {
          content.classList.remove('active');
        });
        
        // Aktifkan tab bab yang dipilih
        document.getElementById(`btn-${tabId}`).classList.add('active');
        document.getElementById(tabId).classList.add('active');
      }

      // Fungsi untuk mengganti tab aktivitas
      function switchAktivitasTab(aktivitasId, babNumber, babData) {
        const aktivitasContainer = document.getElementById(`aktivitasTabs-${babNumber}`);
        
        if (!aktivitasContainer) return;
        
        // Nonaktifkan semua tab aktivitas untuk bab ini
        aktivitasContainer.querySelectorAll('.aktivitas-tab-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        aktivitasContainer.querySelectorAll('.aktivitas-tab-content').forEach(content => {
          content.classList.remove('active');
        });
        
        // Aktifkan tab aktivitas yang dipilih
        const aktivitasBtn = document.getElementById(`btn-${aktivitasId}`);
        const aktivitasContent = document.getElementById(aktivitasId);
        
        if (aktivitasBtn) aktivitasBtn.classList.add('active');
        if (aktivitasContent) aktivitasContent.classList.add('active');
        
        // Jika ini adalah tab soal pilihan ganda, inisialisasi quiz
        if (aktivitasId.includes('-6') && babData.soal_pg) {
          initializeQuizSystem(babData.soal_pg);
          setTimeout(() => {
            if (userAnswers.length === 0) {
              userAnswers = new Array(quizData.length).fill(null);
            }
            loadQuestion();
            createNavigation();
            updateProgress();
            updateButtons();
            
            // Minta nama pengguna jika belum ada
            if (!userName) {
              userName = prompt("Masukkan nama Anda untuk quiz:", "Peserta") || "Peserta";
            }
          }, 100);
        }
      }

      // Fungsi untuk menerapkan filter
      function applyFilters() {
        filteredData = filterData();
        createBabTabs();
      }

      // FUNGSI UNTUK SISTEM QUIZ
      function initializeQuizSystem(soalPgString) {
        // Parse soal pilihan ganda dari string
        quizData = parseQuizData(soalPgString);
        currentQuestion = 0;
        userAnswers = new Array(quizData.length).fill(null);
        
        // Reset nama jika belum diisi
        if (!userName) {
          userName = "Peserta";
        }
      }

      function parseQuizData(soalPgString) {
        const questions = [];
        const soalArray = soalPgString.split('_#_');
        
        soalArray.forEach((soal, index) => {
          const parts = soal.split('|');
          if (parts.length >= 7) { // Soal + 5 opsi + kunci
            const question = parts[0];
            const options = parts.slice(1, 6);
            const correctAnswer = parts[6].trim();
            
            // Konversi kunci jawaban (A,B,C,D,E) ke indeks (0,1,2,3,4)
            let correctIndex = 0;
            if (correctAnswer === 'A' || correctAnswer === '1') correctIndex = 0;
            else if (correctAnswer === 'B' || correctAnswer === '2') correctIndex = 1;
            else if (correctAnswer === 'C' || correctAnswer === '3') correctIndex = 2;
            else if (correctAnswer === 'D' || correctAnswer === '4') correctIndex = 3;
            else if (correctAnswer === 'E' || correctAnswer === '5') correctIndex = 4;
            
            questions.push({
              question: question,
              options: options,
              correctAnswer: correctIndex
            });
          }
        });
        
        return questions;
      }

      function loadQuestion() {
        if (quizData.length === 0) return;
        
        const question = quizData[currentQuestion];
        const questionText = document.getElementById('questionText');
        const optionsContainer = document.getElementById('optionsContainer');
        const quizProgress = document.getElementById('quizProgress');
        
        if (questionText) {
          questionText.innerHTML = `<strong>Soal ${currentQuestion + 1}:</strong> ${question.question}`;
        }
        
        if (quizProgress) {
          quizProgress.textContent = `Soal ${currentQuestion + 1} dari ${quizData.length}`;
        }
        
        if (optionsContainer) {
          optionsContainer.innerHTML = '';
          
          question.options.forEach((option, index) => {
            const optionElement = document.createElement('div');
            optionElement.className = 'option';
            if (userAnswers[currentQuestion] === index) {
              optionElement.classList.add('selected');
            }
            optionElement.innerHTML = option;
            optionElement.dataset.index = index;
            
            optionElement.addEventListener('click', () => selectOption(index));
            optionsContainer.appendChild(optionElement);
          });
        }
        
        updateNavigation();
      }

      function selectOption(index) {
        const options = document.querySelectorAll('.option');
        options.forEach(option => option.classList.remove('selected'));
        
        options[index].classList.add('selected');
        userAnswers[currentQuestion] = index;
        
        updateNavigation();
        updateProgress();
      }

      function createNavigation() {
        const questionNav = document.getElementById('questionNav');
        if (!questionNav) return;
        
        questionNav.innerHTML = '';
        
        quizData.forEach((_, index) => {
          const navItem = document.createElement('div');
          navItem.className = 'nav-item';
          if (index === currentQuestion) {
            navItem.classList.add('active');
          }
          if (userAnswers[index] !== null) {
            navItem.classList.add('answered');
          }
          navItem.textContent = index + 1;
          navItem.addEventListener('click', () => goToQuestion(index));
          questionNav.appendChild(navItem);
        });
      }

      function updateNavigation() {
        const navItems = document.querySelectorAll('.nav-item');
        navItems.forEach((item, index) => {
          item.classList.remove('active', 'answered');
          
          if (index === currentQuestion) {
            item.classList.add('active');
          }
          
          if (userAnswers[index] !== null) {
            item.classList.add('answered');
          }
        });
      }

      function goToQuestion(index) {
        if (index >= 0 && index < quizData.length) {
          currentQuestion = index;
          loadQuestion();
          updateButtons();
        }
      }

      function goToPrevQuestion() {
        const prevBtn = document.getElementById('prevBtn');
        if (prevBtn) {
          prevBtn.addEventListener('click', () => {
            if (currentQuestion > 0) {
              currentQuestion--;
              loadQuestion();
              updateButtons();
            }
          });
        }
      }

      function goToNextQuestion() {
        const nextBtn = document.getElementById('nextBtn');
        if (nextBtn) {
          nextBtn.addEventListener('click', () => {
            if (currentQuestion < quizData.length - 1) {
              currentQuestion++;
              loadQuestion();
              updateButtons();
            }
          });
        }
      }

      function updateButtons() {
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        
        if (prevBtn) {
          prevBtn.style.display = currentQuestion === 0 ? 'none' : 'block';
        }
        
        if (nextBtn && submitBtn) {
          if (currentQuestion === quizData.length - 1) {
            nextBtn.style.display = 'none';
            submitBtn.style.display = 'block';
          } else {
            nextBtn.style.display = 'block';
            submitBtn.style.display = 'none';
          }
        }
        
        // Tambahkan event listener untuk submit button
        if (submitBtn) {
          submitBtn.addEventListener('click', showQuizResults);
        }
      }

      function updateProgress() {
        const answeredCount = userAnswers.filter(answer => answer !== null).length;
        const progress = (answeredCount / quizData.length) * 100;
        const progressFill = document.getElementById('progressFill');
        const progressPercent = document.getElementById('progressPercent');
        
        if (progressFill) {
          progressFill.style.width = `${progress}%`;
        }
        
        if (progressPercent) {
          progressPercent.textContent = `${Math.round(progress)}%`;
        }
      }

      function showQuizResults() {
        // Hitung skor
        let score = 0;
        quizData.forEach((question, index) => {
          if (userAnswers[index] === question.correctAnswer) {
            score++;
          }
        });
        
        // Hitung nilai (0-100)
        const nilai = Math.round((score / quizData.length) * 100);
        
        // Buat string jawaban (ABCDE format)
        let jawabanString = "";
        userAnswers.forEach(answer => {
          if (answer === 0) jawabanString += "A";
          else if (answer === 1) jawabanString += "B";
          else if (answer === 2) jawabanString += "C";
          else if (answer === 3) jawabanString += "D";
          else if (answer === 4) jawabanString += "E";
          else jawabanString += "_"; // Jika belum dijawab
        });
        
        // Format hasil: NAMA/JAWABAN/NILAI
        const hasilFormat = `${userName}/${jawabanString}/${nilai}`;
        
        // Tampilkan di modal
        finalScore.textContent = `${score}/${quizData.length} (${nilai})`;
        resultOutput.textContent = hasilFormat;
        
        // Tampilkan modal
        resultModal.style.display = 'flex';
      }

      // Event listener untuk tombol filter kelas
      filterButtons.forEach(button => {
        button.addEventListener('click', function() {
          // Hapus kelas aktif dari semua tombol
          filterButtons.forEach(btn => btn.classList.remove('active'));
          
          // Tambah kelas aktif ke tombol yang diklik
          this.classList.add('active');
          
          // Dapatkan kelas yang dipilih
          selectedKelas = this.getAttribute('data-kelas');
          
          // Terapkan filter
          applyFilters();
        });
      });

      // Event listener untuk tombol filter semester
      semesterButtons.forEach(button => {
        button.addEventListener('click', function() {
          // Hapus kelas aktif dari semua tombol
          semesterButtons.forEach(btn => btn.classList.remove('active'));
          
          // Tambah kelas aktif ke tombol yang diklik
          this.classList.add('active');
          
          // Dapatkan semester yang dipilih
          selectedSemester = this.getAttribute('data-semester');
          
          // Terapkan filter
          applyFilters();
        });
      });

      // Event listener untuk modal
      closeModal.addEventListener('click', () => {
        resultModal.style.display = 'none';
      });
      
      // Event listener untuk tombol salin hasil
      copyBtn.addEventListener('click', () => {
        const textToCopy = resultOutput.textContent;
        navigator.clipboard.writeText(textToCopy).then(() => {
          alert("Hasil berhasil disalin ke clipboard!");
        });
      });

      // Muat data saat halaman dimuat
      loadData();
      
      // Inisialisasi event listener untuk tombol quiz
      setTimeout(() => {
        goToPrevQuestion();
        goToNextQuestion();
      }, 1000);
    });
  </script>
</body>
</html>
